<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>åŠ å¯†è²¨å¹£æ­¢ææ§“æ¡¿è¨ˆç®—å™¨</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    label, input, select { display: block; margin: 10px 0; }
    input[type="number"] { width: 200px; }
    button { padding: 10px 20px; }
    .result { margin-top: 20px; white-space: pre-wrap; font-weight: bold; }
  </style>
</head>
<body>
  <h2>æ°¸çºŒåˆç´„å®šé‡æ­¢æè¨ˆç®—å™¨</h2>

  <label>æœ¬é‡‘ï¼ˆUSDï¼‰<input type="number" id="capital" step="0.01" /></label>
  <label>æ­¢ææ¯”ä¾‹ï¼ˆ%ï¼‰<input type="number" id="stopPercent" step="0.01" placeholder="å¦‚ 1 ä»£è¡¨ 1%" /></label>
  <label>é€²å ´æ–¹å‘
    <select id="direction">
      <option value="long">åšå¤š</option>
      <option value="short">åšç©º</option>
    </select>
  </label>
  <label>é€²å ´åƒ¹<input type="number" id="entryPrice" step="0.01" /></label>
  <label>æ­¢æè·é›¢ï¼ˆ%ï¼‰<input type="number" id="stopRangePercent" step="0.01" placeholder="ä¾‹å¦‚ 1 è¡¨ç¤º Â±1%" onchange="autoFillStopPrice()" /></label>
  <label>æ­¢æåƒ¹<input type="number" id="stopPrice" step="0.01" /></label>

  <label>å€‰ä½æ¨¡å¼
    <select id="mode">
      <option value="isolated">é€å€‰ï¼ˆIsolatedï¼‰</option>
      <option value="cross">å…¨å€‰ï¼ˆCrossï¼‰</option>
    </select>
  </label>

  <button onclick="calculate()">è¨ˆç®—</button>

  <div class="result" id="output"></div>

  <script>
    function autoFillStopPrice() {
      const entry = parseFloat(document.getElementById("entryPrice").value);
      const direction = document.getElementById("direction").value;
      const percent = parseFloat(document.getElementById("stopRangePercent").value);

      if (!entry || !percent) return;

      const delta = entry * (percent / 100);
      const stopPrice = direction === "long" ? entry - delta : entry + delta;
      document.getElementById("stopPrice").value = stopPrice.toFixed(2);
    }

    function calculate() {
      const capital = parseFloat(document.getElementById("capital").value);
      const stopPercent = parseFloat(document.getElementById("stopPercent").value);
      const entry = parseFloat(document.getElementById("entryPrice").value);
      const stop = parseFloat(document.getElementById("stopPrice").value);
      const mode = document.getElementById("mode").value;
      const direction = document.getElementById("direction").value;

      if (!capital || !stopPercent || !entry || !stop || entry === stop) {
        document.getElementById("output").innerText = "è«‹è¼¸å…¥æ­£ç¢ºæ•¸å€¼ï¼Œä¸”é€²å ´åƒ¹ â‰  æ­¢æåƒ¹ã€‚";
        return;
      }

      const stopLossUSD = capital * (stopPercent / 100);
      const riskPerUnit = Math.abs(entry - stop);
      const positionSize = stopLossUSD / riskPerUnit;
      const notionalValue = positionSize * entry;
      const leverage = Math.floor(notionalValue / capital);
      const actualLossPercent = ((positionSize * riskPerUnit) / capital) * 100;

      const modeText = mode === 'isolated' ? 'é€å€‰' : 'å…¨å€‰';
      const dirText = direction === 'long' ? 'åšå¤š' : 'åšç©º';

      document.getElementById("output").innerText = 
        `ğŸ“Œ æ¨¡å¼ï¼š${modeText}\nğŸ“ˆ æ–¹å‘ï¼š${dirText}
ğŸ’° å¯æ‰¿å—æå¤±é‡‘é¡ï¼š${stopLossUSD.toFixed(2)} USD
ğŸ“Š å€‰ä½å¤§å°ï¼šç´„ ${positionSize.toFixed(4)} å–®ä½
ğŸš€ å»ºè­°æ§“æ¡¿å€æ•¸ï¼š${leverage} å€
âš ï¸ æ½›åœ¨è™§æä½”æœ¬é‡‘ï¼š${actualLossPercent.toFixed(2)}%`;
    }
  </script>
</body>
</html>
