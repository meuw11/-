<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>加密貨幣永續合約定量止損計算器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #f7f9fa;
      max-width: 600px;
      margin: auto;
    }
    input, select, button {
      padding: 8px;
      margin: 8px 0;
      width: 100%;
      font-size: 16px;
    }
    label {
      font-weight: bold;
      margin-top: 12px;
      display: block;
    }
    .output {
      margin-top: 20px;
      background: #eef;
      padding: 15px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h2>永續合約止損計算器</h2>

  <label for="mode">模式</label>
  <select id="mode">
    <option value="isolated">逐倉</option>
    <option value="cross">全倉</option>
  </select>

  <label for="direction">方向</label>
  <select id="direction">
    <option value="long">做多</option>
    <option value="short">做空</option>
  </select>

  <label for="coin">幣種</label>
  <select id="coin" onchange="handleOtherCoin(this)">
    <option>BTC</option>
    <option>ETH</option>
    <option>SOL</option>
    <option>DOGE</option>
    <option>BNB</option>
    <option>XRP</option>
    <option>ADA</option>
    <option>SUI</option>
    <option value="other">其他（請輸入）</option>
  </select>
  <input type="text" id="customCoin" style="display:none;" placeholder="請輸入幣種代號">

  <label for="capital">本金 (USDT)</label>
  <input type="number" id="capital" placeholder="例如：1000">

  <label for="entry">進場價格</label>
  <input type="number" id="entry" placeholder="例如：50000">

  <label for="stopLoss">止損價格</label>
  <input type="number" id="stopLoss" placeholder="例如：48000">

  <label for="slPercent">止損百分比 (%)</label>
  <input type="number" id="slPercent" placeholder="自動填入或自行輸入">

  <label for="leverage">手動設定槓桿倍數（可選填）</label>
  <input type="number" id="leverage" placeholder="例如：5">

  <button onclick="calculate()">計算</button>

  <div class="output" id="result"></div>

  <script>
    function handleOtherCoin(select) {
      const customInput = document.getElementById("customCoin");
      customInput.style.display = select.value === "other" ? "block" : "none";
    }

    function calculate() {
      const capital = parseFloat(document.getElementById('capital').value);
      const entry = parseFloat(document.getElementById('entry').value);
      const stop = parseFloat(document.getElementById('stopLoss').value);
      let slPercent = parseFloat(document.getElementById('slPercent').value);
      const leverageInput = parseFloat(document.getElementById('leverage').value);
      const mode = document.getElementById('mode').value;
      const direction = document.getElementById('direction').value;
      const coin = document.getElementById('coin').value;
      const customCoin = document.getElementById('customCoin').value;
      const coinName = coin === "other" ? customCoin || "自訂幣種" : coin;

      if (!capital || !entry || !stop) {
        alert("請填寫本金、進場價與止損價");
        return;
      }

      // 計算止損百分比
      if (!slPercent) {
        slPercent = Math.abs((stop - entry) / entry) * 100;
        document.getElementById('slPercent').value = slPercent.toFixed(2);
      }

      // 推薦槓桿倍數
      const riskAmount = capital * (slPercent / 100);  // 可承受虧損金額
      const priceDiff = Math.abs(entry - stop);
      const positionSize = riskAmount / priceDiff; // 張數（合約數）
      const positionValue = positionSize * entry; // 倉位價值（美金）

      let maxLeverage = positionValue / capital;
      if (mode === 'cross') {
        maxLeverage = riskAmount / (priceDiff / entry * capital);
      }

      const usedLeverage = leverageInput || Math.floor(maxLeverage);
      const displayLeverage = Math.floor(maxLeverage);

      const realLoss = positionSize * priceDiff;
      const lossPercent = (realLoss / capital) * 100;

      document.getElementById('result').innerHTML = `
        <b>幣種：</b>${coinName}<br>
        <b>方向：</b>${direction === 'long' ? '做多' : '做空'}<br>
        <b>模式：</b>${mode === 'isolated' ? '逐倉' : '全倉'}<br>
        <b>建議槓桿倍數：</b>${displayLeverage} 倍<br>
        <b>倉位大小：</b>${positionSize.toFixed(4)} 張<br>
        <b>倉位價值：</b>${positionValue.toFixed(2)} USDT<br>
        <b>潛在虧損金額：</b>${realLoss.toFixed(2)} USDT<br>
        <b>佔本金比例：</b>${lossPercent.toFixed(2)}%
      `;
    }
  </script>

</body>
</html>

  


  
